global:
  resolve_timeout: 5m

# The root route on which each incoming alert enters.
route:
  # The labels by which incoming alerts are grouped together.
  group_by: ['alertname', 'severity', 'service']

  # When a new group of alerts is created by an incoming alert, wait at
  # least 'group_wait' to send the initial notification.
  group_wait: 30s

  # When the first notification was sent, wait 'group_interval' to send a batch
  # of new alerts that started firing for that group.
  group_interval: 5m

  # If an alert has successfully been sent, wait 'repeat_interval' to
  # resend them.
  repeat_interval: 4h

  # Default receiver
  receiver: 'telegram-notifications'

  # Child routes for different severity levels
  routes:
    # Critical alerts - send immediately
    - match:
        severity: critical
      receiver: 'telegram-critical'
      group_wait: 10s
      repeat_interval: 1h
      continue: true

    # Warning alerts
    - match:
        severity: warning
      receiver: 'telegram-notifications'
      group_wait: 1m
      repeat_interval: 4h

    # Database specific alerts
    - match:
        service: bc-pms-database
      receiver: 'telegram-database'
      group_wait: 30s

# Inhibition rules allow to mute a set of alerts given that another alert is firing.
inhibit_rules:
  # If a critical alert is firing, mute warning alerts for the same service
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service']

  # If service is down, mute other alerts for that service
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.+'
    equal: ['service']

receivers:
  # Main Telegram receiver for all notifications
  - name: 'telegram-notifications'
    telegram_configs:
      - bot_token: 'YOUR_TELEGRAM_BOT_TOKEN_HERE'
        chat_id: YOUR_TELEGRAM_CHAT_ID_HERE
        api_url: 'https://api.telegram.org'
        send_resolved: true
        parse_mode: 'HTML'
        message: |
          {{ if eq .Status "firing" }}üî• <b>ALERT FIRING</b>{{ else }}‚úÖ <b>RESOLVED</b>{{ end }}

          <b>Alert:</b> {{ .CommonAnnotations.summary }}
          <b>Severity:</b> {{ .CommonLabels.severity }}
          <b>Service:</b> {{ .CommonLabels.service }}

          {{ range .Alerts }}
          <b>Description:</b> {{ .Annotations.description }}
          <b>Started:</b> {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ if .EndsAt }}<b>Ended:</b> {{ .EndsAt.Format "2006-01-02 15:04:05" }}{{ end }}
          {{ end }}

          <a href="{{ .ExternalURL }}">View in Alertmanager</a>

  # Critical alerts - more prominent formatting
  - name: 'telegram-critical'
    telegram_configs:
      - bot_token: 'YOUR_TELEGRAM_BOT_TOKEN_HERE'
        chat_id: YOUR_TELEGRAM_CHAT_ID_HERE
        api_url: 'https://api.telegram.org'
        send_resolved: true
        parse_mode: 'HTML'
        message: |
          {{ if eq .Status "firing" }}üö®üö®üö® <b>CRITICAL ALERT</b> üö®üö®üö®{{ else }}‚úÖ <b>RESOLVED</b>{{ end }}

          <b>Alert:</b> {{ .CommonAnnotations.summary }}
          <b>Service:</b> {{ .CommonLabels.service }}

          {{ range .Alerts }}
          ‚ö†Ô∏è <b>{{ .Annotations.description }}</b>

          <b>Started:</b> {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ if .Annotations.runbook_url }}
          üìñ <a href="{{ .Annotations.runbook_url }}">Runbook</a>
          {{ end }}
          {{ end }}

          <b>Action Required Immediately!</b>
          <a href="{{ .ExternalURL }}">View in Alertmanager</a>

  # Database specific alerts
  - name: 'telegram-database'
    telegram_configs:
      - bot_token: 'YOUR_TELEGRAM_BOT_TOKEN_HERE'
        chat_id: YOUR_TELEGRAM_CHAT_ID_HERE
        api_url: 'https://api.telegram.org'
        send_resolved: true
        parse_mode: 'HTML'
        message: |
          {{ if eq .Status "firing" }}üóÑÔ∏è <b>DATABASE ALERT</b>{{ else }}‚úÖ <b>RESOLVED</b>{{ end }}

          <b>Alert:</b> {{ .CommonAnnotations.summary }}
          <b>Severity:</b> {{ .CommonLabels.severity }}

          {{ range .Alerts }}
          <b>Description:</b> {{ .Annotations.description }}
          <b>Started:</b> {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}

          <a href="{{ .ExternalURL }}">View in Alertmanager</a>

  # Null receiver for silenced alerts
  - name: 'null'

# Templates for customizing notifications (optional)
templates: []
